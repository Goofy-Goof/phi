apiVersion: skaffold/v2beta28
kind: Config
metadata:
  name: phi
build:
  tagPolicy:
    gitCommit:
      ignoreChanges: true
  insecureRegistries:
    - docker.io
  local:
    useBuildkit: true
    concurrency: 0
  artifacts:
  - image: goofygoof/phi-tinkgw
    ko:
      main: ./tinkgw
      dependencies:
        paths: [ "proto/*.go" ]
  - image: goofygoof/phi-core
    ko:
      main: ./core
      dependencies:
        paths: [ "proto/*.go" ]
  - image: goofygoof/phi-ledger
    ko:
      main: ./ledger
      dependencies:
        paths: [ "proto/*.go" ]
  - image: goofygoof/phi-ui
    context: ./ui

deploy:
  kustomize:
    paths:
    - k8s/tinkgw
    - k8s/core
    - k8s/ledger
    - k8s/ui
  kubectl:
    manifests:
    - k8s/configmap.yaml
